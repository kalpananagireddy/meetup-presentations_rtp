---
title: "Introduction to R Markdown"
author: "Sheila Saia"
date: "July 31, 2019"
output:
  ioslides_presentation: default
  beamer_presentation: default
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Welcome to R-Ladies RTP!

## Materials

- All source code at https://github.com/rladies/rtp_20190731_rmarkdown

- Demo materials at http://bit.ly/rladies-rmd-demo and on GitHub (will come up later)

- See R Markdown Cheatsheet in meetup source code for help

- Thanks to Mine Cetinkaya-Rundel for her R Markdown materials!

- R Packages that we will use today: `dplyr`, `ggplot2`, `rmarkdown`, `knitr`, `DT`, `flexdashboards`

## Load Libraries for Today's Workshop

```{r load libraries, eval=FALSE}
packages <- c("dplyr", "ggplot2", "rmarkdown", "knitr", 
              "DT", "flexdashboards")
install.packages(packages)
lapply(packages, library, character.only = TRUE)
```

What do each of these R packages do?

## Workshop Objectives

By the end of this workshop you will be able to:

1. **describe** what R Markdown is and why it's helpful

2. **modify** R Markdown templates to generate simple reports

3. **identify** where you can find additional R Markdown resources

# Recording and Reporting Your Analysis

## Options

- Writing code in the Console -- error prone (especially typo prone!) and hard to keep track of

- R Script + LaTeX/Word -- can be reproducible with careful organization but still error prone

- R Markdown -- code, output, prose all in one place and fully reproducible, can call R scripts as well

## R Markdown

- R Markdown is an authoring format that enables easy creation of dynamic documents, presentations, and reports from R.

- R Markdown documents are fully **reproducible**, they can be 
automatically regenerated whenever underlying R code or data changes.

- R Markdown files will have an .Rmd file extention.

- File -> New File -> R Markdown...

**DEMO 1**

## Key R Markdown Features:

1. An (optional) header surrounded by - - - s

2. R code chunks surrounded by ```s

3. Text mixed with simple markdown formatting

    - Human readable! (in RStudio -> Help -> Markdown Quick Reference)
    
    - Limited, so not too time consuming to master
    
4. Self contained workspace

## R Markdown Installation

If you have not yet done so:

```{r eval=FALSE}
install.packages("rmarkdown") # run this line once per computer
library(rmarkdown) # run this line everytime you want to use R Markdown
```

# Reports

## How It Works

(in case you're interested...)

![](img/RMarkdownFlow.png)

- When you knit, R Markdown feeds the .Rmd file to knitr, which executes all of the code chunks and creates a new markdown (.md) document which includes the code and its output.

- The markdown file generated by knitr is then processed by pandoc which is responsible for creating the finished format. 

## Practice Exercise

- If you have not yet done so:

```{r eval=FALSE}
    install.packages("ggplot2")
    install.packages("dplyr")
```
    
- Open demo > demo-template.Rmd in RStudio and Knit.

<br><br>

**DEMO 2**

## R Markdown Output Options

- HTML - web ready

- PDF - requires TeX to be installed

- Word - can be useful if collaborators are Word users, but their changes cannot be easily integrated

# R Code in R Markdown Documents

## Two options:

- Code chunks

- Inline code (I will cover this, if we have time.)

## Code Chunks

- Let's practice inserting a new code chunk:
    + keyboard shortcut Ctrl + Alt + I (OS X: Cmd + Option + I)
    + the Insert command in the editor toolbar (see other languages as well)
    + typing the chunk delimiters (\`\`\`{r} to start, \`\`\` to end)

- When file is rendered R Markdown will run each code chunk and embed the results beneath the code chunk in your final report

<br><br>

**DEMO 3**

## Chunk Options

Chunk output can be customized with knitr options, arguments set in the { } of a chunk header.

Can label code chunks for easy navigation around R Markdown document.

Can set global code chunk options at the top of your R Markdown document using `knitr::opts_chunk$set(<insert option here>)`

## Chuck Option Examples
- `include = FALSE`: code runs and results be used by other chunks, but doesn't appear in finished file

- `echo = FALSE`:  prevents code, but not the results from appearing in the finished file (useful way to embed figures)

- `eval = FALSE`: prevents code chuck from being evaluated (useful way to show but not run code)

- `message = FALSE`: messages do not appear in the finished file

- `warning = FALSE`: warnings do not appear in the finished file

- `fig.cap = "..."` adds a caption to graphical results

See [R Markdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) for all options.

## Working Through demo_template.Rmd

Let's work through the demo-template.Rmd file.

Try task #3 with a partner and regroup. Try not to look at the solution file (demo-solution.Rmd) unless you're really stuck.

<br><br>

**DEMO 4**

# Notebooks

## Notebook

- When you open an R Markdown file in the RStudio IDE, it becomes a notebook interface for R. 

- You can run each code chunk by clicking the green arrow icon. RStudio executes the code and display the results inline with your file.

- Other chunk actions (global options, notebook outline viewer, etc.)

<br><br>

**DEMO 5**

## Version control with notebooks

- One of the major advantages of R Notebooks compared to other notebook systems is that they are plain-text files and therefore work well with version control

- If using version control, check both the .Rmd and .nb.html files into version control so that both your source code and output are available to collaborators

- If you want each collaborator to work with their own private copies of the output check only the .Rmd file (with a .gitignore that excludes the .nb.html)

## More on Notebooks

See http://rmarkdown.rstudio.com/r_notebooks.html

# More with R Markdown

## More with R Markdown

- Slide presentations
    + `beamer_presentation` - PDF presentations with beamer
    + `ioslides_presentation` - HTML presentations with ioslides
    + `slidy_presentation` - HTML presentations with slidy
    + `revealjs::revealjs_presentation` - HTML presentations with reveal.js

- Websites: `rmarkdown::render_site`

- Interactive documents/flexdashboards: using `htmlwidgets` or `Shiny` packages

- Blogs: using `blogdown` package

- Books: using `bookdown` package

## Even More with R Markdown

- See ["R Markdown: Eight Ways"](https://www.rstudio.com/resources/videos/r-markdown-eight-ways/) talk by Mine Cetinkaya-Rundel at  for more ways to use R Markdown

- YAML header options: https://bookdown.org/yihui/rmarkdown/html-document.html (table of contents, etc.)

- Equation formatting: https://www.calvin.edu/~rpruim/courses/s341/S17/from-class/MathinRmd.html and http://www.stat.cmu.edu/~cshalizi/rmarkdown/

- So much more in [R Markdown the Definitive Guide](https://bookdown.org/yihui/rmarkdown/)

# Workshop Wrap Up

## Final Discussion

What makes R Markdown generated reports, etc. reproducible? 

How do you hope to use R Markdown?

# Reports (Bonus)

## Adding Images

Add images to text chuck using:

`![](img/my_image.png)`

A caption can go within the `[ ]`

Best to store these in within a separte `img` directory within the .Rmd file directory.

## Caching

`cache = TRUE`

Tricky, but can be useful!

References:

- http://yihui.name/knitr/options/

- http://yihui.name/knitr/demo/cache/

## Inline Code

Code results can be inserted directly into the text of a .Rmd file by enclosing the code with \` r\`

See bottom of demo-template.Rmd for an example.

<br><br>

**DEMO 6**

# Tables (Bonus)

## Tables

Not super easy to customize, but there are some options that are easy to use and look good (i.e., using `DT` package)

## knitr::kable {.small}

```{r}
knitr::kable(mtcars[, 1:5])
```

## DT::datatable {.small}

```{r}
DT::datatable(mtcars[, 1:5], extensions = 'ColReorder', 
              options = list(colReorder = TRUE, 
                             pageLength = 5))
```

# Dashboards (Bonus)

## flexdashboards

- Dashboards based on R Markdown: easy to compose and publish

- Intelligent resizing: to fill browser and display on mobile devices

- Support a wide variety of components: htmlwidgets, base, lattice, and grid graphics, tabular data, gauges and value boxes, and text

- Shiny compatible!

## Install

```{r eval=FALSE}
install.packages("flexdashboard")
library(flexdashboard)
```

## Get Started

In RStudio:

File -> New File -> R Markdown... -> From Template -> Flex Dashboard

## Layouts

http://rmarkdown.rstudio.com/flexdashboard/layouts.html

# Debugging (Bonus)

## Debugging Tips for R Markdown

- Line number in error message -- note that this will refer to the beginning of the R chunk, hence shorter R chunks make debugging easier

- `knitr::knit_exit()`: stop knitting HERE
